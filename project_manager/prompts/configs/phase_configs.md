# 阶段配置

## 阶段定义

### BASIC_DESIGN（基本设计）
- **阶段目标**：完成项目的基本设计和架构规划
- **专注内容**：业务逻辑、系统架构、数据库设计、外部接口
- **必需输出**：业务流程图、系统架构图、ER图、API清单
- **评审权重**：
  - 业务完整性：30%
  - 数据库设计：25%
  - 架构合理性：25%
  - 接口定义：20%
- **通过分数**：80分
- **最大迭代**：5次
- **回退触发**：数据库设计无法支持、架构存在根本缺陷

### DETAIL_DESIGN（详细设计）
- **阶段目标**：完成详细的代码架构和算法设计
- **专注内容**：代码架构、算法设计、数据结构、类设计
- **必需输出**：类图、算法伪代码、数据结构定义、时序图
- **评审权重**：
  - 类设计：30%
  - 数据结构：25%
  - 算法合理性：25%
  - 模块耦合：20%
- **通过分数**：80分
- **最大迭代**：4次
- **回退触发**：数据库设计无法支持、架构存在根本缺陷

### DEVELOPMENT（开发实现）
- **阶段目标**：完成代码实现和功能开发
- **专注内容**：功能实现、代码质量、异常处理、性能优化
- **必需输出**：源代码、配置文件、数据库脚本、README
- **评审权重**：
  - 功能完整性：35%
  - 代码规范：25%
  - 异常处理：20%
  - 性能优化：20%
- **通过分数**：85分
- **最大迭代**：4次
- **回退触发**：数据结构无法实现、算法逻辑漏洞

### UNIT_TEST（单元测试）
- **阶段目标**：完成单元测试和代码质量验证
- **专注内容**：单元测试覆盖、边界测试、异常测试
- **必需输出**：测试用例、测试代码、覆盖率报告
- **评审权重**：
  - 测试覆盖：35%
  - 边界测试：30%
  - 异常测试：35%
- **通过分数**：90分
- **最大迭代**：3次
- **回退触发**：核心功能测试失败、设计缺陷

### INTEGRATION_TEST（集成测试）
- **阶段目标**：完成系统集成和端到端测试
- **专注内容**：系统集成、端到端测试、性能测试
- **必需输出**：集成测试用例、性能报告、部署文档
- **评审权重**：
  - 集成完整性：40%
  - 性能达标：30%
  - 稳定性：30%
- **通过分数**：95分
- **最大迭代**：3次
- **回退触发**：系统集成失败、性能不达标

## 阶段流转规则

### 正常流转
1. 当前阶段评审通过（达到通过分数且无Critical问题）
2. 迭代次数未超过限制
3. 满足阶段转换条件

### 强制流转
1. 达到最大迭代次数
2. 系统检测到死循环
3. 手动强制转换

### 回退规则
1. 检测到Critical级别问题
2. 满足回退触发条件
3. 系统自动回退到合适阶段

## 质量门禁配置

### 基础配置
- **允许回退**：True
- **每阶段最大回退次数**：2次
- **总回退次数限制**：5次
- **强制前进阈值**：3次迭代

### 评分规则
- **总分制**：25分制
- **权重分配**：按阶段配置的权重分配
- **问题分级**：Critical > Major > Minor
- **通过阈值**：按阶段配置的通过分数

### 迭代控制
- **最大迭代次数**：按阶段配置
- **死循环检测**：同一内容重复评审3次
- **强制转换**：达到最大迭代次数时自动转换

## 输出文件规范

### 文件命名
- **设计文档**：`{phase_name}_v{iteration}.md`
- **代码文件**：`{module_name}.py`
- **测试文件**：`test_{module_name}.py`
- **配置文件**：`config.yaml`

### 文件结构
```
project_manager/{project_name}/
├── phase_outputs/
│   ├── basic_design/
│   ├── detail_design/
│   ├── development/
│   ├── unit_test/
│   └── integration_test/
├── status.json
└── reports/
```

### 状态文件格式
```json
{
  "project_name": "项目名称",
  "current_phase": "当前阶段",
  "current_iteration": "当前迭代次数",
  "current_mode": "当前模式",
  "project_status": "项目状态",
  "latest_score": "最新评分",
  "blocking_issues": "阻塞问题",
  "improvement_suggestions": "改进建议",
  "review_count": "评审次数",
  "from_rollback": "是否来自回退",
  "rollback_count": "回退次数",
  "quality_gate": "质量门禁配置"
}
```
